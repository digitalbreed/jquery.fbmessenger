/*!
 * jQuery.fbMessenger
 * Simulates interaction with a Facebook Messenger bot on an iPhone
 *
 * Version: 0.0.6
 * Author: Matthias Gall <matthias.gall@digitalbreed.com>
 * Copyright (c) by Matthias Gall 2016, all rights reserved.
 *
 * https://github.com/digitalbreed/jquery.fbmessenger
 */
!function(a){function b(b,c){this.element=b,this.$element=a(b),this.options=a.extend(!0,{},d,c),this.init()}var c="jquery.fbmessenger",d={botLogoUrl:"botlogo.png",botName:"jQuery.fbMessenger",botCategory:"Software",botWelcomeMessage:"jQuery.fbMessenger is a plugin to simulate interaction with a Facebook Messenger bot on an iPhone.",leftUser:"bot",rightUser:"user",displayedCarrier:"o2-de",displayedTime:"22:00",scrollTimeMs:500,loop:!0,dateFormat:function(a){var b=function(a){var b=""+a;return b.length<2&&(b="00"+b),b.substring(b.length-2)},c=["JAN.","FEB.","MAR.","APR.","MAY","JUN.","JUL.","AUG.","SEP.","OCT.","NOV.","DEC."];return a.getDate()+". "+c[a.getMonth()]+", "+b(a.getHours())+":"+b(a.getMinutes())},script:[],state:{welcomeMessageDisplayed:!0,lastTimestamp:null,quickRepliesDisplayed:!1}};b.prototype._likeText=function(a){if("function"==typeof this.options.likeTextFn)return this.options.likeTextFn(a);var b,c=this.options.likes?this.options.likes.totalCount:void 0;return b=void 0===c?"25K":c>999?(c/1e3).toFixed(1)+"K":c,b+=" people like this",!a&&this.options.likes&&(this.options.likes.friendName&&this.options.likes.otherFriendsCount?b=b+" including "+this.options.likes.friendName+" and "+this.options.likes.otherFriendsCount+" friends":this.options.likes.friendName?b=b+" including "+this.options.likes.friendName:this.options.likes.otherFriendsCount&&(b=b+" including "+this.options.likes.otherFriendsCount+" friends")),b},b.prototype.init=function(){this.$element.append('\t\t\t<div class="jsm-iphone-content-wrapper">\t\t\t<div class="jsm-iphone-content">\t\t\t\t<div class="jsm-status-navbar">\t\t\t\t\t<div class="jsm-status-bar">\t\t\t\t\t\t<div class="jsm-carrier">\t\t\t\t\t\t\t<span class="jsm-carrier-ring closed"></span>\t\t\t\t\t\t\t<span class="jsm-carrier-ring closed"></span>\t\t\t\t\t\t\t<span class="jsm-carrier-ring closed"></span>\t\t\t\t\t\t\t<span class="jsm-carrier-ring open"></span>\t\t\t\t\t\t\t<span class="jsm-carrier-ring open"></span>\t\t\t\t\t\t\t<span class="jsm-carrier-name">'+this.options.displayedCarrier+'</span>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="jsm-battery">\t\t\t\t\t\t\t<span class="jsm-battery-percent">51 %</span>\t\t\t\t\t\t\t<img class="jsm-battery-image"  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAATCAYAAAA5+OUhAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AgTFgId4dfTCwAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAAw0lEQVRIx93XsQ5BMRgF4I/IvYPEC1hNJoPXMJokFgZvYrZ4CV7AC5hYSDyGRQwkwtKBy3hvoj3JSZr/b9pz2qbtDxnG2OP5x9wHnVmRDQwxwwQn/4sulnhgVUweQod5BauXlcxu0PsRr4XJclxCsEzkFezIrThu/a2diRR1CSBmE2es0W5EbKKJAVopHKd+CiaaKZi4pmBiF7uJDaYx3055so/dPWYTR3SwiEBvJ+j9wghb9Cr4OpfJXtA5+pGLv7J7ATA1fYuDT5NBAAAAAElFTkSuQmCC">\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="jsm-clock">'+this.options.displayedTime+'</div>\t\t\t\t\t</div>\t\t\t\t\t<div class="jsm-nav-left">\t\t\t\t\t\t<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAqCAYAAACtMEtjAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AgVFDEPwOpMwQAAAtBJREFUWMO110tIFVEcx/HvmTshZqa9EAXLUnxcymcJarnxUWlYWS5qES56QC3LIBxbOHeTrYMeiyJoIWUZlkkq9jAixdf1qmgS9EJCBKM2wdw7LUTSdObqzNyzPDOXz/0ffufM+UMohqq1owbeLZySQoB0IVzFCJGPqr2enxaOIvWBbiRRsGhO93dQJ5c4B3kCH0DkLvtM97e6HEL6QOw2fC7EL+EAMgQi3fgFvR9FyrEehqSkMDyBkSDIAIqUYz11eVXhVE94QbiDINnWU5dXFU554zCIRBNkEEXKsr6PSi9FUN44ulpkdRVVXIskt2YERLwJMoQiZS4bvBUhVbeiyDwzii7irCArg04+2ID7xBiIGKtIcOjU400kHxkDscUE8aJIGcH+rzF0uiOGhCIfsNkuYgydfRPL1n0+YKMJMowipa80S0uh8z3xxO3xAtFOIUuhC/3biM3yAuudRBZDNcOJRO8cQCfSBPGhSLusnFpz0JWxZNal9qMTEQoEQObiRzcRSb3orA0VMnfWhQkJEWQ/BQLjdj9bc8DlTylEbe8zXbqAv4mr8nHrFQE07Bhn1pcB/DZ+03UMVWuyV9Gq4u1/giJXWqtoftzI/sy3925g1vgnrqN4tGZ7EMDN/O98eetGMGOCHUbVntqDAG4XTjH5Ig30aeNFd1Wgai32IIC7ZdNMNKeB/sMEO4RHe2YPArhfOcPQnRTQp0yWsRxVe24PAnh47ic911NA/2pSWRkerdX6F/b/G1Bhgw9EgvFJ5W+jTj5oD/p3p/OCSDLBXlIn77cHzV+FqycGQaSabOp2FLnUXiM2OfmHe8mZoPtMAlKCqrXbq2hpu5JtUlknilxsv7VUpBzQe0wqK0LVOp1rLVWtG+EqMAnIK2ea5Tp5L/i7jCFpjbPNskdrA9fiaAu9l1op19n2X5EPgL9lUTNWK+USslGvPcIT8C6c+gtjuOq4cXN0IAAAAABJRU5ErkJggg==">\t\t\t\t\t\tHome\t\t\t\t\t</div>\t\t\t\t\t<div class="jsm-nav-title">\t\t\t\t\t\t<div class="jsm-nav-title-bot-name">'+this.options.botName+'</div>\t\t\t\t\t\t<div class="jsm-nav-title-replies-in">Typically replies in minutes</div>\t\t\t\t\t</div>\t\t\t\t\t<div class="jsm-nav-right">\t\t\t\t\t\tManage\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div class="jsm-chat-content-wrapper"><div class="jsm-chat-content-wrapper-2">\t\t\t\t<div class="jsm-chat-content">\t\t\t\t\t<div class="jsm-chat-progress-indicator jsm-hide">\t\t\t\t\t\t<div class="jsm-bot-icon">\t\t\t\t\t\t\t<img src="'+this.options.botLogoUrl+'" />\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t\t<div class="jsm-bot-welcome-message">\t\t\t\t\t\t<div class="jsm-bot-welcome-banner" style="background-image:url('+this.options.botBannerUrl+')">\t\t\t\t\t\t\t<div class="jsm-bot-welcome-icon"><img src="'+this.options.botLogoUrl+'" /></div>\t\t\t\t\t\t</div>\t\t\t\t\t\t<h1>'+this.options.botName+"</h1>\t\t\t\t\t\t<h2>"+this.options.botCategory+"</h2>\t\t\t\t\t\t<p>"+this._likeText(!1)+'</p>\t\t\t\t\t\t<div class="jsm-bot-welcome-status">\t\t\t\t\t\t\t<div class="jsm-bot-welcome-status-svg-wrapper">\t\t\t\t\t\t\t\t<svg viewBox="0 0 50 50"><path d="M24.22 1A23.219 21.268 0 0 0 1 22.27a23.219 21.268 0 0 0 8.597 16.5l-.767 7.994 7.13-4.643a23.219 21.268 0 0 0 8.26 1.416A23.219 21.268 0 0 0 47.44 22.27 23.219 21.268 0 0 0 24.22 1z" fill-rule="evenodd" stroke="#007aff" stroke-width="2" fill="#fff"/></svg>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<p>Typically replies in minutes</p>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="jsm-bot-welcome-status">\t\t\t\t\t\t\t<div class="jsm-bot-welcome-status-svg-wrapper">\t\t\t\t\t\t\t\t<svg viewBox="0 0 52 52"><circle cx="24.548" stroke="#007aff" cy="24.548" r="23.548" stroke-width="2" fill="none"/><path fill="#007aff" d="M20.023 19.97v.9h2.39v16.504h-2.39v.899h9v-.899h-2.398V19.97h-6.602z"/><circle cx="24.519" cy="14.265" r="2.049" fill="#007aff"/></svg>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<p>'+this.options.botWelcomeMessage+'</p>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t\t<div class="jsm-bot-info">\t\t\t\t\t\t<img src="'+this.options.botLogoUrl+'">\t\t\t\t\t\t<div class="jsm-bot-info-name">'+this.options.botName+'</div>\t\t\t\t\t\t<div class="jsm-bot-info-likes">'+this._likeText(!0)+'</div>\t\t\t\t\t\t<div class="jsm-bot-info-category">'+this.options.botCategory+'</div>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t</div></div>\t\t\t\t<div class="jsm-bottom-bar">\t\t\t\t\t<div class="jsm-quick-replies jsm-hide">\t\t\t\t\t\t<div class="jsm-quick-replies-container">\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t\t<div class="jsm-get-started">\t\t\t\t\t\t<p class="jsm-get-started-info">When you tap Get Started, '+this.options.botName+' will see your public info.</p>\t\t\t\t\t\t<div class="jsm-get-started-button">Get Started</div>\t\t\t\t\t</div>\t\t\t\t\t<div class="jsm-input-message jsm-hide">\t\t\t\t\t\t<img class="jsm-persistent-menu" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAaCAYAAADbhS54AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AgUFCEdwS1IvQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAARklEQVRIx+3VQQ0AIBADwZagDl0gCewVEzwuZKtg0s9aM1vSUK2dpoqz4iQlbTUfAwYMGLAPYN1LtJJWAgMGDBgwWvmulRdvjBDe+GiHkQAAAABJRU5ErkJggg==">\t\t\t\t\t\tType a message&hellip;\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t</div>\t\t\t</div>\t\t');var b=navigator.userAgent;(b.indexOf("iPhone")>0||b.indexOf("iPod")>0)&&this.$element.find(".jsm-chat-content").addClass("ios"),a(window).resize(this._handleResize.bind(this)),this._handleResize()},b.prototype.start=function(a){return void 0===a||void 0===a.delay?this.options.state.welcomeMessageDisplayed&&(this.$element.find(".jsm-bot-welcome-message,.jsm-get-started").addClass("jsm-hide"),this.$element.find(".jsm-input-message").removeClass("jsm-hide"),this.options.state.welcomeMessageDisplayed=!1):this.options.script.push({method:"start",args:[],delay:a.delay}),this},b.prototype._checkWelcomeMessage=function(){this.options.state.welcomeMessageDisplayed&&a.error("Must call start before sending messages")},b.prototype._checkUser=function(b){!b in[this.options.leftUser,this.options.rightUser]&&a.error("Unknown user "+b)},b.prototype._checkQuickReply=function(b){b!==!0||this.options.state.quickRepliesDisplayed?b===!1&&this.options.state.quickRepliesDisplayed&&a.error("Quick replies are already displayed"):a.error("Quick replies are currently not displayed")},b.prototype._scrollDown=function(){var a=this.$element.find(".jsm-chat-content").prop("scrollHeight");this.$element.find(".jsm-chat-content").animate({scrollTop:a},this.options.scrollTimeMs)},b.prototype._clearOptions=function(b){var c=a.extend({},b);return delete c.delay,c},b.prototype._handleResize=function(){var b=this.$element.width()||.5622*this.$element.height(),c=Math.floor(b/750*24);this.$element.css("font-size",c+"px"),this.$element.parent().toggleClass("jsm-force-redraw");var d=this;this.$element.find(".title").css("height","auto"),setTimeout(function(){var e=d.$element.find(".jsm-generic-template");e.css("width","calc("+b+"px - 6em - 4px)"),e.each(function(b){var c=a(this).find(".title");c.css("height",Math.max.apply(Math,c.map(function(){return a(this).outerHeight()}))+"px")});var f=d.$element.find(".jsm-user-wrapper."+d.options.leftUser);f.each(function(b){var d=a(this).height()-3.5*c,e=a(this).find(".jsm-user-icon");e.css("top",d+"px")}),d._scrollDown()},1)},b.prototype._addNewContent=function(b,c,d){var e=parseInt(a(this.element).css("font-size")),f=this.$element.find(".jsm-chat-content");b===this.options.leftUser&&f.find(".jsm-status").remove(),f.find(".jsm-chat-row:has(.jsm-typing-indicator)").remove();var g=f.find(".jsm-user-wrapper:last"),h=null,i=0===g.length||!g.hasClass(b);if(i?(g=a('<div class="jsm-user-wrapper '+b+'"></div>'),b===this.options.leftUser&&(h=a('<div class="jsm-user-icon"><img class="jsm-bot-logo" src="'+this.options.botLogoUrl+'"><img class="jsm-messenger-flash" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AgVDxUiZK69gwAABCVJREFUSMe1lltMHFUYx3/nzO6yS6EkwjZRpAv2ZYWXxoTYqDWA9cH2ASOmiDbwoFEbE31ppBAN6YPWmupbo6SJCTTFktaKNraJF2g0IjZpi0ZWSiRlsaGGBQJ2ge1eZnw4DLuzVy71n0wy55sz/3++75zvIoKhIMmYWprn5NhlNClwfjuI07WFKu9OKh7yahUlD3hcxduahRAtAIaudwXnAt13bo75p33DscC1X/hiRxlBp5NXnqynxvsI6SDSCQ/P+fn67+u4pYvGUKEs3VXbKm22I4Cd7IiEo5GOgdGrxy7+Pqi/13CQgjxX+p3BUNDyLIYWOfvXIJcmrxOORVqNDSISi7YZhkGmJ8VjKSTT4UXNU1CynOjhxAL0+qB/AnwBCCwpuzsfKt1QVw6NlVBeZI0A4AJiOUPtcricUshlc+1fgLYBJaob2eMshRL/oA62b7XSAiGr8N1FMBSj0+7UNKlFzY89I/DaRQiGWRcKHNC5F16ssphtiZ7L4MwcAHbNjia1VU8//hUO9K1fFNQ/B/rg+JDFHLVER4/GEELgsDlazTPtGYFD34PBxmEAb/+guBLQthrqKf8E7tJSadNsMYDJf6Gqc2OeZgr7H6+CJ37pNECXUpPYNFuraT3cf+9EzbC3DVhM7QBifnaGovuKw4B9YgF2nMh9e9cLKWD8DUuqCenMz9fMs11LygA8WJh7jybAZVPvugFnrGetSUee02Ou+idyE75VDaMHYU9F5j27y+DNaggl3OMBv2WLRwohms2VL5Bd9HkvfPQ0bLHDN43Q4LV+Ly2E089C++Nw4qo1K5K4myXQYq7MMpjJi1P1KoQADg16n4OXd0KeBocfg9HXwVsM+89DOKlITlu5W2zJuZcOlSXw1X5w2uDnW1B9vxLWBJzcBx27oWwr3JyHfb1wZw1ZIQ1d7zIX2/JTN5QWwqUmmA9Bwzl4ogueORMnFyjRmSVl/yeYXiiJu0sGA7e7Vz1zWzcX5cG5BvhsWBWV8zfil3DP6fjRLEWg/izcmM3sYRJ3t5wd/3P1vtWVx784NFXkX/gSjvwEy1Er0ZUpqDmlutdLfTB4K3toazyWpV/e/m0ottI3aaxUyQ6qYX1yTRFngm8GHv4U+sZyF5Ama6eKyckrPxK9G+oAVVkaK1c6uL62qpQciXRIGhDeBZCRpSDjAxeOmdajtaqw3ysUOBRnAt4HkAC+Cz26Ho20g+oinXvVbd0sBIrLY/VWBxBj3/Wx/dEa8gqLAMJm3T4+pPqpsQnRD5+CQ7tSzOrFMCzUWuKk8H+OPsnCAE5gU8Pe0VpLeNMPe2mEUzw3x9vPR+CyH0aSxtsqt8rTpqqU8TbF03h9zjJ0G4bRZmwc72TjziWMYRhyhWQ9gjIXb6ZQZxwsAA/QnNBOu4BuwJ82pBnwH0NDmSsr0rnYAAAAAElFTkSuQmCC"></div>'),g.append(h)),f.append(g)):g.hasClass(this.options.leftUser)&&(h=g.find(".jsm-user-icon")),$wrapper=a('<div class="jsm-chat-row"></div>'),d!==!1){var j=this.options.dateFormat(d?d:new Date);j!==this.options.state.lastTimestamp&&($wrapper.append('<div class="jsm-chat-timestamp">'+j+"</div>"),this.options.state.lastTimestamp=j)}$wrapper.append(c),g.append($wrapper),h&&setTimeout(function(){var a=g.height()-3.5*e;i?h.css("top",a+"px"):h.animate({top:a},250)},1);var k=g.find(".jsm-chat-message");if(k.each(function(b){b>0&&a(this).addClass("jsm-has-previous"),b<k.length-1&&a(this).addClass("jsm-has-next")}),g.hasClass(this.options.leftUser)){var l=f.find(".jsm-chat-progress-indicator");setTimeout(function(){var a=g.position().top+g.height()-1*e;l.hasClass("jsm-hide")?(l.removeClass("jsm-hide"),l.css("top",a+"px")):l.animate({top:f.scrollTop()+a},250)},1)}this._scrollDown()},b.prototype.message=function(b,c,d){if(void 0===d||void 0===d.delay){this._checkWelcomeMessage(),this._checkUser(b);var e=b===this.options.leftUser?"jsm-left":b===this.options.rightUser?"jsm-right":"",f="";b===this.options.rightUser&&(f='<div class="jsm-status"><svg preserveAspectRatio="xMidYMid meet" viewBox="0 0 59.15224 59.754372"><g transform="translate(-243.19 -357.27)" stroke="#007aff" stroke-width="5" fill="none"><ellipse rx="27.076" ry="27.377" cy="387.15" cx="272.77"/><path d="m259.07 388.96 7.6772 8.1288 19.871-19.72"/></g></svg><svg class="jsm-hide" preserveAspectRatio="xMidYMid meet" viewBox="0 0 59.15224 59.754372"><g transform="translate(-243.19 -357.27)" stroke-width="5"><ellipse rx="27.076" ry="27.377" stroke="#007aff" cy="387.15" cx="272.77" fill="#007aff"/><path d="m259.07 388.96 7.6772 8.1288 19.871-19.72" stroke="#fff" fill="none"/></g></svg></div>');var g=a('<div class="jsm-chat-message '+e+" "+(d.className||"")+'">'+c+f+"</div>");this._addNewContent(b,g,d.timestamp),f&&setTimeout(function(){g.find("svg:first").addClass("jsm-hide"),g.find("svg:last").removeClass("jsm-hide")},300)}else this.options.script.push({method:"message",args:[b,c,this._clearOptions(d)],delay:d.delay});return this},b.prototype.typingIndicator=function(b){return void 0===b||void 0===b.delay?(this._checkWelcomeMessage(),this._addNewContent(this.options.leftUser,a('<div class="jsm-chat-message jsm-left jsm-typing-indicator"><span></span><span></span><span></span></div>'),!1)):this.options.script.push({method:"typingIndicator",args:[],delay:b.delay}),this},b.prototype.showQuickReplies=function(b,c){if(void 0===c||void 0===c.delay){this._checkWelcomeMessage(),this._checkQuickReply(!1);var d=this.$element,e=d.find(".jsm-quick-replies-container").empty();a.each(b,function(a,b){e.append('<div class="jsm-quick-reply-option" style="transition-delay: '+(.1*a).toFixed(1)+'s">'+b+"</div>")}),d.find(".jsm-quick-replies").removeClass("jsm-hide").prop("scrollLeft",0);var f=this;setTimeout(function(){f._scrollDown(),d.find(".jsm-quick-reply-option").addClass("jsm-show")},10),this.options.state.quickRepliesDisplayed=!0}else this.options.script.push({method:"showQuickReplies",args:[b,this._clearOptions(c)],delay:c.delay});return this},b.prototype.scrollQuickReplies=function(a,b){if(void 0===b||void 0===b.delay){this._checkWelcomeMessage(),this._checkQuickReply(!0);var c=this.$element.find(".jsm-quick-replies"),d=c.find(".jsm-quick-replies-container"),e=this.$element.find(".jsm-quick-reply-option:nth-child("+(a+1)+")"),f=c.prop("scrollLeft"),g=f+e.position().left,h=-1;if(g+e.outerWidth()>c.width())h=g-parseInt(e.css("marginRight"));else if(g<f){var i=(d.outerWidth()-d.width())/2;h=Math.max(0,g-i)}h>-1&&c.animate({scrollLeft:h},Math.abs(f-h))}else this.options.script.push({method:"scrollQuickReplies",args:[a,this._clearOptions(b)],delay:b.delay})},b.prototype.selectQuickReply=function(b,c){if(void 0===c||void 0===c.delay){this._checkWelcomeMessage(),this._checkQuickReply(!0);var d=this.$element,e=this,f=d.find(".jsm-quick-reply-option:nth-child("+(b+1)+")").addClass("jsm-selected");setTimeout(function(){d.find(".jsm-quick-reply-option").removeClass("jsm-show"),setTimeout(function(){e.message(e.options.rightUser,f.text(),{timestamp:!1,className:"jsm-quickreply"});var a=d.find(".jsm-chat-message:last");setTimeout(function(){a.removeClass("jsm-quickreply")},100)},100)},500),setTimeout(function(){d.find(".jsm-quick-replies").animate({height:0},function(){e.options.state.quickRepliesDisplayed=!1,a(this).addClass("jsm-hide").css("height","")})},700)}else this.options.script.push({method:"selectQuickReply",args:[b,this._clearOptions(c)],delay:c.delay});return this},b.prototype.showButtonTemplate=function(b,c,d){if(void 0===d||void 0===d.delay){this._checkWelcomeMessage(),this._checkQuickReply(!1);var e='<div class="jsm-chat-message jsm-left jsm-button-template"><div class="jsm-header">'+b+'</div><div class="jsm-buttons">';a.each(c,function(a,b){e+='<div class="jsm-button">'+b+"</div>"}),e+="</div></div>",this._addNewContent(this.options.leftUser,a(e),d.timestamp)}else this.options.script.push({method:"showButtonTemplate",args:[b,c,this._clearOptions(d)],delay:d.delay})},b.prototype.selectButtonTemplate=function(a,b){if(void 0===b||void 0===b.delay){this._checkWelcomeMessage(),this._checkQuickReply(!1);var c=this.$element.find(".jsm-chat-content .jsm-button-template:last .jsm-buttons .jsm-button:nth-child("+(a+1)+")").addClass("jsm-selected");setTimeout(function(){c.removeClass("jsm-selected")},1500),this.message(this.options.rightUser,c.text(),{timestamp:!1})}else this.options.script.push({method:"selectButtonTemplate",args:[a,this._clearOptions(b)],delay:b.delay})},b.prototype.showGenericTemplate=function(b,c){if(void 0===c||void 0===c.delay){this._checkWelcomeMessage(),this._checkQuickReply(!1);var d='<div class="jsm-chat-message jsm-left jsm-generic-template-wrapper"><div class="jsm-generic-template-background">';a.each(b,function(b,c){d+='<div class="jsm-generic-template '+(0===b?"jsm-selected":"")+'">',c.imageUrl&&(d+='<div class="jsm-image" style="background-image: url(\''+c.imageUrl+"');\"></div>"),d+='<div class="jsm-title"><p>'+c.title+"</p><p>"+c.subtitle+"</p></div>",a.each(c.buttons,function(a,b){d+='<div class="jsm-button">'+b+"</div>"}),d+="</div>"}),d+="</div></div>",this._addNewContent(this.options.leftUser,a(d),c.timestamp);var e=this.$element.find(".jsm-generic-template-wrapper:last .jsm-generic-template"),f=this.$element.width();e.css("width","calc("+f+"px - 6em - 4px)");var g=e.find(".jsm-title");g.css("height",Math.max.apply(Math,g.map(function(){return a(this).outerHeight()}))+"px")}else this.options.script.push({method:"showGenericTemplate",args:[b,this._clearOptions(c)],delay:c.delay})},b.prototype.scrollGenericTemplate=function(a,b){if(void 0===b||void 0===b.delay){this._checkWelcomeMessage(),this._checkQuickReply(!1);var c=this.$element.find(".jsm-generic-template-wrapper:last"),d=c.find(".jsm-generic-template:first").outerWidth(!0)+2;c.find(".jsm-generic-template").removeClass("jsm-selected"),c.find(".jsm-generic-template:nth-child("+(a+1)+")").addClass("jsm-selected"),c.animate({scrollLeft:a*d},250)}else this.options.script.push({method:"scrollGenericTemplate",args:[a],delay:b.delay})},b.prototype.selectGenericTemplate=function(a,b){if(void 0===b||void 0===b.delay){this._checkWelcomeMessage(),this._checkQuickReply(!1);var c=this.$element.find(".jsm-generic-template-wrapper:last .jsm-generic-template.jsm-selected .jsm-button:eq("+a+")").addClass("jsm-selected");setTimeout(function(){c.removeClass("jsm-selected")},1500),this.message(this.options.rightUser,c.text(),{timestamp:!1})}else this.options.script.push({method:"selectGenericTemplate",args:[a,this._clearOptions(b)],delay:b.delay})},b.prototype.run=function(){0===this.options.script.length&&a.error("script is empty");var c=this,d=function(a){a>c.options.script.length-1&&c.options.loop&&(c.reset(),a=0);var e=c.options.script[a];e&&setTimeout(function(){b.prototype[e.method].apply(c,e.args),d(a+1)},e.delay)};d(0)},b.prototype.reset=function(){this.$element.find(".jsm-quick-replies-container").empty(),this.$element.find('.jsm-chat-content > :not(".jsm-bot-welcome-message,.jsm-bot-info,.jsm-chat-progress-indicator")').remove(),this.$element.find(".jsm-bot-welcome-message,.jsm-get-started").removeClass("jsm-hide"),this.$element.find(".jsm-input-message,.jsm-chat-progress-indicator").addClass("jsm-hide"),this.$element.find(".jsm-chat-content")[0].scrollTop=0,this.options.state.welcomeMessageDisplayed=!0,this.options.state.quickRepliesDisplayed=!1},a.fn.fbMessenger=function(d){if(void 0===d||"object"==typeof d)return this.each(function(){a(this).data(c)||a(this).data(c,new b(this,d))});if("string"==typeof d&&"_"!==d[0]&&"init"!==d){var e=Array.prototype.slice.call(arguments,1);return this.each(function(){var f=a(this).data(c);f instanceof b&&"function"==typeof f[d]&&f[d].apply(f,e)})}}}(jQuery);